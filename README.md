# MyMediaPlayer

通过交叉编译 [ffmpeg-4.0.2](https://ffmpeg.org/releases/) 来实现对于本地视频或rtmp协议音视频进行解码播放。

其中通过 ANativeWindow 与 SurfaceView 进行绑定来实现视频的显示，通过 OpenSLES 来实现音频的播放。

1. 音视频的同步
播放过程中根据音频 time base 以及当前流的帧时间戳来作为音频的时间点， 
在视频中通过 fps 以及 extra_delay 得到视频的作为视频时间点，
以获取到音频的时间点为基准对比当前视频时间点，
在视频的最终提交给 ANativeWindow 进行丢帧或者等待操作来实现音视频的播放同步。

2. 音视频的播放与暂停
通过控制 AVPacket 队列以及 AVFrame 队列的工作状态来实现音视频播放与暂停的控制

3. 音视频的播放进度调整
通过 ffmpeg 的 avformat 的 seek 方法实现音视频的播放进度调整

4. 性能优化
通过新建子线程来完成音视频流解封装并控制其插入线程安全的 AVPacket 阻塞队列当中的数量来避免性能以及内存的浪费，
同样通过子线程完成对于 AVPacket 阻塞队列解封装后的包进行读取以及解码成可以直接进行播放的 AVFrame 数据，
同时释放 AVPacket 资源避免内存占用，同样控制其插入线程安全的 AVFrame 阻塞队列当中的数量来避免性能以及内存的浪费。
对于最终子线程异步读取 AVFrame 队列的数据播放后及时释放其资源释放内存占用避免内存泄漏。